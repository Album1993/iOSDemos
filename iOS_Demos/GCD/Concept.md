## 进程


### 1.进程是什么

> 引自维基百科进程（英语：**process**），是计算机中已运行程序的实体。进程为曾经是分时系统的基本运作单位。在面向进程设计的系统（如早期的UNIX，Linux 2.4及更早的版本）中，进程是程序的基本执行实体；在面向线程设计的系统（如当代多数操作系统、Linux 2.6及更新的版本）中，进程本身不是基本运行单位，而是线程的容器。
> 程序本身只是指令、数据及其组织形式的描述，进程才是程序（那些指令和数据）的真正运行实例。
> 若干进程有可能与同一个程序相关系，且每个进程皆可以 **同步（循序）** 或 **异步（平行）**的方式独立运行。现代计算机系统可在同一段时间内以进程的形式将多个程序加载到内存中，并借由时间共享（或称**时分复用**），以在一个处理器上表现出**同时（平行性**）运行的感觉。
> 同样的，使用多线程技术（多线程即每一个线程都代表一个进程内的一个独立执行上下文）的操作系统或计算机架构，同样程序的平行线程，可在多**CPU**主机或网络上真正同时运行（在不同的**CPU**上）。


在 **iOS** 系统中，一个 **APP** 的运行实体代表一个进程。 一个进程有独立的  _内存空间、系统资源、端口_  等。 在进程中可以生成多个线程、这些线程可以共享进程中的资源。
打个比方，**CPU**好比是一个工厂，进程是一个车间，线程是车间里面的工人。车间的空间是工人们共享的，比如许多房间是每个工人都可以进出的。这象征一个进程的内存空间是共享的，每个线程都可以使用这些共享内存。

<br>

### 2.进程间通信

搜集了一下资料，**iOS**大概有8种进程间的通信方式，可能不全，后续补充。
**iOS**系统是相对封闭的系统，**App**各自在各自的沙盒（**sandbox**）中运行，每个App都只能读取**iPhone**上**iOS**系统为该应用程序程序创建的文件夹**AppData**下的内容，不能随意跨越自己的沙盒去访问别的**App**沙盒中的内容。 所以**iOS**的系统中进行**App**间通信的方式也比较固定，常见的**App**间通信方式以及使用场景总结如下。

#### 1、Port (local socket)
* 上层封装为`NSMachPort : Foundation`层 
* 中层封装为`CFMachPort ：Core Foundation`层 
* 下层封装为`Mach Ports : Mach`内核层（**线程、进程都可使用它进行通信**）

一个**App1**在本地的端口**port1234**进行**TCP**的**bind**和**listen**，另外一个**App2**在同一个端口**port1234**发起**TCP**的**connect**连接，这样就可以建立正常的**TCP**连接，进行**TCP**通信了，那么就想传什么数据就可以传什么数据了。但是有一个限制，就是要求两个**App**进程都在活跃状态，而没有被后台杀死。 _尴尬的一点是iOS系统会给每个**TCP**在后台**600**秒的网络通信时间，**600**秒后**APP**会进入休眠状态_ 。
#### 2、URL Scheme
这个是**iOS App**通信最常用到的通信方式，**App1**通过**openURL**的方法跳转到**App2**，并且在**URL**中带上想要的参数，有点类似**http**的**get**请求那样进行参数传递。这种方式是使用最多的最常见的，使用方法也很简单只需要源**App1**在**info.plist**中配置**LSApplicationQueriesSchemes**，指定目标**App2**的**scheme**；然后在目标**App2**的**info.plist**中配置好**URL types**，表示该**App**接受何种**URL Scheme**的唤起。


![](-./Resources/concept1.png)


